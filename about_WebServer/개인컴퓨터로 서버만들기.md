# 개인 컴퓨터를 서버로 사용하기

**강의 링크**
**https://www.inflearn.com/course/web2-home-server/dashboard**

## IPV4 & IPV6

전화를 할 때 전화번호가 필요한 것과 같이 인터넷 기기가 서로 통신하려면 각 기기에 해당하는 ip주소가 할당되어 있어야 한다.

 지금 대중적으로 사용하고 있는 ip 주소는 IPV4이고 (0~255).(0~255).(0~255).(0~255) 형식이다. 42억개 정도의 경우의 수가 있는데 스마트폰, 사물인터넷 등 인터넷 기기가 늘어나면서 주소의 개수가 부족해졌다. 

 그래서 나온 것이 IPV6이다. 훨씬 더 많은 경우의 수를 지원할 수 있지만 벌써 사용하고 있는 IPV4의 형식을 모두 바꿀 수 없기 때문에 조금 씩 같이 사용하고 있는 상태이다.


## Router (공유기)

 ISP(Internet Service Provider)에 회선 1개를 신청하면 1개의 public ip 주소를 할당 받을 수 있다. 하지만 여러개의 기기를 사용하고 싶다고 여러개의 회선을 발급받기에는 비용도 많이 들고 ip주소도 부족하다. 따라서 공유기에게 public ip 주소를 할당하고 나머지 기기들은 local ip 주소를 할당하여 사용할 수 있다.

>ISP -(WAN포트)공유기(LAN포트)- 노트북, 핸드폰 등

알아보기 어려울 수 있겠지만,, 공유기에는 WAN(wide area network)과 LAN(local area network)포트가 있는데 WAN은 세계의 다른 네트워크에서도 접속이 가능한 network로의 연결이고 LAN쪽은 나의 공유기가 지원하는 로컬 지역에서만 유효한 network로의 연결이다.

공유기는 WAN과 LAN 쪽에 하나씩 ip 주소가 있는 형태가 되는데, 공유기가 ISP에서 할당받은 ip 주소는 public ip 주소, 그리고 "Gateway Address"라고도 부르는 local ip 주소가 있다. 이 local 주소는 192.168.0.1으로 "Gateway Address" 또는 "Router Address"라고 부른다.

그리고 공유기의 LAN과 연결된 기기들은 뒤에서 다룰 DHCP라는 프로토콜에 의해서 192.168.0~255.0~255 형식의 local ip 주소를 자동할당 받게 된다. 이러한 주소는 public으로 사용하지 않도록 정해놓은 사설 ip 주소이다. 더 많은 local 주소가 필요할 경우 사용할 수 있는 다른 사설 ip 주소도 있다고 한다.

## NAT (Network Address Translation)

local ip 주소를 가진 기기에서 외부 인터넷에 접속하기 위해 필요한 기술이다. 주로 공유기에서 사용된다.

예를 들어 192.168.0.2라는 사설 ip를 가진 노트북에서 wikipedia에 접속하려고 한다고 해보자. 노트북에서는 "192.168.0.2에서 wikipedia로 웹페이지 정보를 요청"하는 소켓(?)을 만들어 공유기에 보내게 된다. 그러면 이걸 받은 공유기는 다음 단계를 거쳐 외부에 요청을 하고 정보를 받아온다.

1. local ip를 소켓(?) 다른 부분에 저장
2. local ip 부분에 자신의 public ip 주소 입력
3. 요청 보내기

그리고 WAN 네트워크에서 wikipedia 서버가 이에 대한 응답을 보내서 공유기가 그 소켓(?)을 받았다면

4. 어딘가 저장되어있는 local ip를 찾아서 해당 기기로 정보 전달

전달하는 단위가 소켓이었는지 정확하지 않아서 물음표 붙였다.
아무튼 공유기가 행하는 일련의 과정을 NAT라고 한다.

**+ 나의 public ip 주소 알아보기 : 인터넷에 "my ip"라고 검색하면 나의 public ip 주소를 알아내주는 웹페이지도 운영중이다.**

## Port

포트란 한 기기에서 여러가지 서버를 운영/서버와 통신할 수 있기 때문에 그 중 누구와 상호작용할지 정하기 위한 하나의 주소?이다. 예를들어 웹서버, 게임서버, 채팅서버, 미디어 서버, ftp 서버 등등 한 기기에서 여러가지 서버가 필요할 수 있다. 주로 0~1023은 well known 포트로 쓰임새가 벌써 정해져 있는데 예를 들어 22번은 ssh포트, 80번은 http포트로 사용된다. 

예를들어 특정 사이트에 접속할 때
> http:// ~ 

라고 치면 http(웹페이지 통신규약)이기 때문에 자동으로 80포트로 연결된다. 하지만 만약 다른 포트로 연결하고 싶다면
> http:// ~ :8080

이런식으로 끝에 세미콜론과 해당 포트번호를 적어주면 된다.

더 자세한 내용이 궁금하면 "url format"을 검색해보자.

## Port Forwarding

public ip에 누군가가 접속할 때 특정 private ip로 자동 연결되게 만들어보자. 이때 port 번호를 이용할 수 있다.

예를 들어 59.6.66.238 :8081 -> 192.168.0.4 :80

이렇게 연결을 해주기 위해서는 공유기에 접속하여 메뉴에서 [NAT/라우터 관리] - [포트포워드 설정] 아래에서 설정을 해줄 수 있따.


## Dynamic & Static IP

Dynamic은 말하자면 돌려막기이다. 모든 사람이 동시에 인터넷을 사용하지는 않기 때문에 부족한 ip 주소를 모든 사람에게 다 할당해줄 필요는 없다. 사용하지 않는 사람의 ip 주소는 회수해서 다른 사용 중인 사람에게 할당해줄 수 있다. 이런 것이 Dynamic ip 주소이다.

하지만 만일 서버를 운영하고 싶은데 내 ip 주소가 계속 바뀐다면 잘 돌아가지 않겠지? 그래서 통신사에 2-3만원 정도 내면 한개의 ip 주소를 독점하여 지속적으로 사용할 수 있는데 이것이 Static ip 주소이다.


## DHCP (Dynamic Host Configuration Protocol)

DHCP 서버는 주로 공유기에 내장되어 있고 클라이언트는 인터넷 사용 기기에 내장되어 있다. DHCP가 하는 일은 공유기에 새로운 기기가 연결될 때 자동으로 private ip 주소를 할당해주는 것이다. 다음과 같은 과정을 거친다. (MAC 주소란 물리적 기기의 고유한 일련 번호이다)

1. 통신 기기에서 공유기로 자신의 MAC 주소와 ip주소 요청을 보낸다
2. 공유기의 DHCP 서버는 요청을 받고 임대가능한 private ip 주소가 있는지 확인한다. 존재한다면 공유기의 MAC 주소와 함께 해당 ip를 통신 기기에게 알려준다.
3. 통신기기에서 승낙한다.
4. 공유기는 통신기기의 MAC 주소와 private ip 주소를 저장해두고 임대 시간을 알려준다.

처음에 통신 기기에서 공유기로 요청할 때는 broadcasting을 하는걸까? 아무튼 추가로 내 컴퓨터의 private ip 주소를 고정하는 방법도 있다. 공유기에 접속 후 [네트워크 관리] - [내부 네트워크 설정]에서 DHCP 기능들을 설정 가능한데 특정 기기와 ip 주소를 고정으로 짝지어줄 수 있다. 이렇게 되면 static ip가 되는 것이겠지! DHCP를 사용하여 자동 할당 되는 ip로 계속 사용한다면 dynamic ip인 것이고!

#

NAS, DDNS, web/server hosting, cloud computing 등의 개념들을 더 배워보자!

